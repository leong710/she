# PPC
Particular Physical Checkup (PPC) - 特殊健康檢查

## 240814 -- 起始工程
    1. 建構權限管理介面
    2. 建構廠區清單管理：
        2-1. 添加新欄位[osha_id]
        2-2. _local功能將視實際需求進行取捨。<待調整>

    3. 建構特殊危害健康作業管理index：
        3-1. 新增篩選查詢功能。
        3-2. 新增下載Excel介面功能(根據篩選結果輸出)。
        3-3. 新增上傳Excel介面功能+上傳結果檢視和範例檔。

    4. 新增單筆新增功能 form.php，增加部門代號查詢功能：
        4-1. 同步更新api-center-hrdb的服務功能。
        4-2. 增加監聽驗證：當類別選定"噪音"時，會提示均能音量和8小時平均音壓二擇一填寫。
        4-3. 增加監聽驗證：HE_CATE/類別至少要選一項，防止空單送出錯誤。(採用判斷空陣列方式)
        4-4. 新增模式有Reset鈕，編輯模式不存在。
        4-5. submit送出給process_crud.php進行處理，內藏(check_HE_CATE)辨識部門代號+類別是否是第一筆，若是則以swal顯示提醒!

    5. 新增危害類別管理功能：
        5-1. 可以新增新[代碼][類別]
        5-2. 可以刪除舊類別
        5-3. 未設置編輯功能，防止物件錯誤，直接用5-1、5-2取代。
        5-4. 檔案輸出成JSON檔，節省資料庫資源。

## 240821
    1. 建構特危作業人員管理：
        1-1. 建構篩選階層：廠別 > 部門代號 > 取得人事資料庫(hrdb即時)。
        1-2. audit 廠別、部門代號 至少需勾選一項，才能進行查詢。
        1-3. 增加驗證(is-invalid)提醒(invalid-feedback)功能，提醒使用人勾選。
        1-4. 取得之員工資料暫時貼在p2(員工清單中)，因為資料龐大，搭配外掛function DataTable來使用，可達到分頁、排序、搜尋...等功能。
        1-5. 預留功能：單筆新增、Excel批次上傳、Excel下載功能。
        1-6. 因為員工資料取得後的作為與顯示方式需與user(惠旭)進行協調，顯示配置方式、對應功能 (8/19已提供)
        1-7. 增加一清空table(_shLocal)功能，因為權限過大，需要開通mySQL內user權限，並限制使用對象、使用時機(使用前禁止上傳或編輯)。

    extra. deBug工作：
        2-1. 圖書館-深耕 新增文件 原本-限制窗口以上；升級改版-環安同仁。
        2-2. PPE系統 廠調器材 原本收貨人需要在db中才能顯示 接收按鈕；升級改版-只要是自己轄區都可接收。

## 240828
    1. 續建特危作業人員管理：
        1.1. Excel批次上傳功能建構完成。
        1.2. Excel批次上傳後會篩出部門代碼，並以此部門代碼匯入(整併)到目前使用的特危作業清單 
        1.3. 單筆新增功能建構完成，可以工號、姓名、NT帳號進行模糊搜尋，在依查詢結果選擇帶入。
        1.4. 單筆新增後會篩出部門代碼，並以此部門代碼匯入(整併)到目前使用的特危作業清單 
        1.5. 增加單筆名單刪除功能，可剔除非必要人員。
        1.6. 增加[特作項目]修改功能，可針對之前選錯的部分進行修正。==> 有Bug，改用先前單選特危作業的方式進行覆蓋。(用覆蓋已解)
        1.7. 當選定或修正特作項目後，隨即更新該筆資料與顯示，並篩出有含噪音之項目，做資格判定(目前完成方法A+B+C)
        1.8. 增加噪音判斷公式：checkNoise，可判定出樣本A、樣本B和驗證結果

## 240905
    1. 續建特危作業人員管理：
        1.1. user要求去除到職日欄位，增加轉調欄位...轉調欄位功能尚待釐清，原到職日埋在姓名按鈕的title中。
        1.2. 增加[資格驗證]欄位，暫時顯示noise(噪音)、newOne(新進)、regular(定期)、change(變更)的驗證結果true、false。目前僅噪音顯示正常
        1.3. 特檢資格 增加 符合特檢的項目
        1.4.

## 240912
    1. 續建特危作業人員管理：
        1.1. [資格驗證]欄位，newOne(新進) 欄位已經可顯示是否為新人...(待加入辨識是否編入在特危場所的單位中)
        1.1. [資格驗證]欄位，change(變更) 比對今年和去年單位部門代碼的不同，並在轉調欄位中明顯顯示，(維獨還需要加上辨識是在[特危場所]的in或out...0912完成)
        1.2. 增加[下載]功能，已可對當年度的資料進行下載...(編輯後可上拋存檔? 不行! 因為上傳簡單，下載複雜，除非雙方表單一致...)
        1.3. 因應護理師對照需求，將姓名工號以外的欄位進行上下層分割，上層為當年度，下層有底色的為去年度。
        1.4. 因為欄位繁多，顯示上容易變形，建議使用24吋+解析度1920x1080dpi之顯示器，以利判讀。
        1.5. 補足 Excel匯入時只有健檢類別代號而其他資訊空虛的問題...

## 240919
    1. 續建特危作業人員管理：
        1.1. 升級[提取存檔員工資料]功能，由一次按一個單位，升級成多選後一次帶入。
        1.2. 改善[提取部門現況名單]執行效率，由step-2點選時產生文字串、監聽文字串變化再生成step3，升級成step-2點選時不產生文字串也不監聽，直接由step-3點擊時才去過濾step-2的勾選清單。
        1.3. 特檢資格之泡泡標籤升級成分類顏色。

## 241021
    1. owner需求修正：
        1.1. 特危作業管理由 整體刪除 => 勾選刪除 ok
        1.2. Label變更作業特殊健檢 => 定期特殊健檢 ok
        1.3. Excel上傳名單時，不自動帶入特作項目!!!
## 241023
    1. 功能優化：
        1.1. 部門代號dept_no的變更檢查進行深層比對調部門這件事，取紀錄中今年和去年的紀錄出來驗證。
        1.2. 匯入staff資料時，暫時不比對hrdb，以Excel內容為主，同一人第一筆為今年目前，第二筆為過往紀錄。
        1.3. 關閉由hrdb帶入部門人員的功能。(已自板塊中清除)
        1.4. 配合特危作業管理改成勾選刪除功能，下載功能升級成 勾選下載，未勾選則為全部下載。

## 241028
    1.
        1.1. 今年度匯入之人員名單，只要今年度待過的部門，在提取部門名單中都會出現，例如：梅爾之前在FAB6，之後到T6，提取名單時會出現在FAB6和T6中出現。(只分拆當年度)
        1.2. ** FAB6和T6的窗口不可以同時編輯，有導致儲存衝突....(這一點我還不知道該怎麼避免...)
        1.3. 原本匯入FAB6時可以挑當時FAB6的危害地圖，存檔後再提出，此時會以目前人事資料庫上的部門代號來撈危害地圖。補強提取資料後原本只抓最外層的部門代號'shCase，補上shCase_logs內當年度'shCase

# 241107
    1. Bug修復與優化：
        1.1. 事故訪談系統...asIs：所有損工項目，都需要進行職災申報。 toBe：增加判斷模組，損工職災申報排除 1.廠外交通事故、2.設備/其他事故。
        1.2. 圖書館 添加教材時無法選擇專題分類。 已修復，原因是value尾端少了結尾符號 " ，導致顯示成空值的錯誤。
        1.3. 圖書館 教材課程級別超過3以上的，導致無法閱讀的狀況。已修復，原因是開頭判斷級別分類的switch其default的尾端加上了return...移除後即恢復正常。
        1.4. tnESHip 上頭圖書館新書跑馬燈之超連結未更新到新的播放模組。已修復：連結到新的修復模組。
    2. 健檢系統：
        2.1. 取消前後單位都可提取的功能，只保留新單位可以提取及填寫暴露時間...
        2.2. 提取功能後方增加完成度(%)顯示功能，可讓使用者了解編輯進度。

# 241108
    1. 緊急聯絡電話查詢系統權限開啟，T1、T2、T3 共12人，查詢測試驗證完成，已可正常使用。
        T1：07000573黃俊繻/16023999吳聲鋐/23010993詹雅婷/24007088吳韋德
        T2：20031603卓榆豐/22007143鄭凱文/23013054林志翰/24007089陳茗祥
        T3：14062892詹珀勝/10167939徐凡茵/12095547洪聖皇/24003601陳朝志

    2. 圖書館加入北廠使用權限：
        2.1. 新增人員(12人)：
            10003355/吳宜蓁、04000669/李仁志、20031603/卓榆豐、11083897/侯志郎、23008796/商芸蓁、22006438/連詩涵、
            22011862/郭翔宇、21001775/陳明維、21007805/陳憶瑩、07000573/黃俊繻、24008256/楊智程、24005323/蔡雯雯
            ** 10003355/吳宜蓁 => 名單有誤，該人員無NT帳號，無法開權限。已告知展生。
            ** 11/14 吳宜蓁工號誤植，須修正成：12064653
        2.2. site使用環境(8個部門環境)：
            已加入jnESH環安處、jn環安衛一部、jnHQ環安課、jn健康管理課、jn廢資課、jn環安衛二部、jnT3環安課、jnJOC環安課
        2.3. classify專題新增：在jn環安處環境下新設一[主題分享]，附掛PM在jnESH(一般分享)下。

## 軟體設計原則 KISS (Keep it simple, stupid)


# 250206
    a. PPE Bug修正與功能優化：
        a1. 除汙劑管理頁面下載Excel時產生頁面錯誤，且無任何回應。
            1.已修復：下載的函示遺失?誤刪? 已將函式補上，測試已可正常下載。
        a2. 料號管理需增加一欄位MOQ：...已完成
            1. 資料庫table_pno 已加上MOQ欄位，預設值null
            2. 料號管理頁面、新增/編輯模組 已加上MOQ欄位
            3. Excel上傳、下載功能及範例檔已加上MOQ欄位
            4. crud Function 已加上MOQ
        a3. 請購需求需加上MOQ欄位與請購數量：...已完成
            1. 顯示頁面已加上MOQ和請購數量欄位(加上新Fun來達成)
            2. Excel下載已納入這2欄需求
        a4. 請購需求下載成Excel檔時，細項需求能否展開?(現況是濃縮成一欄)：...已完成
            1. 新增2陣列，對應x廠區、y型號、v數量，及fabKey清單
            2. 於檢視清單上隱藏選染(不顯示)，以免造成視覺混亂。
            3. 測試下載Excel已順利於欄位末端展開各廠獨立的需求數量。

    b. 健檢系統開發：
        b1. 2/4 user回饋需調整欄位順序與部分名稱....(她承認...當初沒想好)...已完成
            調整範圍1...危害健康作業地圖：顯示、新增編輯模組、Excel上傳/下載模組...ok
            調整範圍2...定期特殊健檢：顯示、新增編輯模組、Excel上傳/下載模組...ok
            調整範圍3...特檢名單審查：顯示、編輯模組、Excel上傳/下載模組...ok
            調整範圍4...名單總匯整：顯示、Excel上傳/下載模組...ok
        b2. 每個人都必須有一筆[暴露時數]，不論他是否有噪音作業。
            現況：只有點選噪音作業，才會出現暴露時數登錄的欄位，且key入數值才會進行判斷資格...
            調整範圍1...定期特殊健檢：顯示、新增編輯模組、判斷模組、Excel上傳/下載模組...ok
            調整範圍2...特檢名單審查：顯示、編輯模組、判斷模組、Excel上傳/下載模組...onGoing
            調整範圍3...名單總匯整：顯示、Excel上傳/下載模組...onGoing

    c. 廢棄物清理統計分析報表系統化評估
        c1. 已回饋給照賢，並指出報告須補正之處，並增加方案3。
        c2. 2/4 會議討論簡報內容，並回饋須補正之處。
        c3. 2/6 照賢提供v2版簡報，並加上預估之開發時程，我已先回復時間會延後，且已先送冠勳初審。

    d. 中央合作提案goESH app
        此方案仿winHR，內容全部以環安日常作業之應用為主，邀我們加入提案評估。
        評估方向：提質、增效、降本、減存
        初步應用：SDS查詢、ISO稽核小卡、防颱點檢....等

# 250210 
    A. SHE進度溝通：
        1. 單位轉調名單/變更管理：
           1a. 維持由大PM上傳(by月)，欄位需有工號、姓名、前部門代號、前部門名稱
           1b. 後端帶入HR人事資料找出目前(當下)新的部門代號和部門名稱
           1c. 後端使用前部門代號和目前部門代號 比對出轉入或轉出 特危作業場所，並撈出特危工作清單...
           1d. 保留[護理師判定是否執行]的部分
           1e. 變更健檢通知 與 資料回覆 => 統一由部門主管回覆 (因為直接人員無NT帳號可登入) => 通知時間頻率、方法、回覆期限再議
           1f. 回覆內容 => 需填上 健檢時間、健檢醫院、上傳健檢收據(PDF或圖檔，限制檔案512KB以下，保存一年(由上傳日起算))
           1g. [變更管理]之按鈕位置設置於NAV[定期特殊健檢]上方
           1h. 可向人資溝通是否有資料庫可以直接抓取，省去人資與護理師重工作業時間。

        2. 特殊健檢--匯入3-去年檢查項目
           2a. 文字樣式：變更(噪音),定期(銦)
           2b. 基本由Excel匯入時帶入，有去年資料時，由去年資料嘗試帶入(須注意前後合併問題)
           2c. 保留編輯功能for總窗，可以用文字編輯。

        3. 變更管理 和 特殊健檢 table是否分開或合併，eshIT需要審慎評估。